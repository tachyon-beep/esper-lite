groups:
  - name: tolaria-graphs
    interval: 15s
    rules:
      - alert: TolariaGraphStageCopySlow
        expr: avg_over_time(tolaria_graph_stage_copy_ms[1m]) > 0.5
        for: 2m
        labels:
          severity: warning
          team: tolaria
        annotations:
          summary: Tolaria graph stage copy latency exceeds 0.5 ms
          description: |
            Stage copy latency averaged {{ $value | printf "%.3f" }} ms over the last minute.
            Investigate staging stream overlap or excessive GPU load.
      - alert: TolariaGraphCaptureWarning
        expr: avg_over_time(tolaria_graph_capture_ms[1m]) > 200
        for: 1m
        labels:
          severity: warning
          team: tolaria
        annotations:
          summary: Tolaria graph capture exceeds 200 ms
          description: |
            Capture latency averaged {{ $value | printf "%.0f" }} ms in the last minute.
            Check graph pool reuse and warm-up state before falling back.
      - alert: TolariaGraphCaptureCritical
        expr: avg_over_time(tolaria_graph_capture_ms[5m]) > 1000
        for: 2m
        labels:
          severity: critical
          team: tolaria
        annotations:
          summary: Tolaria graph capture remains above 1 s
          description: |
            Capture latency averaged {{ $value | printf "%.0f" }} ms while graphs are enabled.
            Verify warm-up pool instantiation or disable graphs.
      - alert: TolariaGraphReplaySlow
        expr: avg_over_time(tolaria_graph_replay_ms[1m]) > 0.5
        for: 2m
        labels:
          severity: warning
          team: tolaria
        annotations:
          summary: Tolaria graph replay latency exceeds 0.5 ms
          description: |
            Replay latency averaged {{ $value | printf "%.3f" }} ms over the last minute.
            Confirm staged buffers stay on device and compute overlaps correctly.
      - alert: TolariaGraphFallbackDetected
        expr: increase(tolaria_graph_fallback_total[5m]) > 0
        for: 0m
        labels:
          severity: warning
          team: tolaria
        annotations:
          summary: Tolaria graph fallback observed
          description: |
            Fallbacks recorded in the last 5 minutes. Inspect `tolaria.graph_fallback` events
            for error context and disable graphs if unstable.
