# Finding Ticket: Unused `epoch` Parameter in CounterfactualHelper

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B5-CR-02` |
| **Severity** | `P2` |
| **Status** | `open` |
| **Batch** | 5 |
| **Agent** | `codereview` |
| **Domain** | `simic/attribution` |
| **Assignee** | |
| **Created** | 2024-12-27 |
| **Updated** | 2024-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/simic/attribution/counterfactual_helper.py` |
| **Line(s)** | `95, 108` |
| **Function/Class** | `compute_contributions`, `compute_contributions_from_results` |

---

## Summary

**One-line summary:** The `epoch` parameter is accepted but never used in either method.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [x] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
def compute_contributions_from_results(
    self,
    slot_ids: list[str],
    results: dict[tuple[bool, ...], tuple[float, float]],
    epoch: int | None = None,  # NEVER USED
) -> dict[str, ContributionResult]:
```

The `epoch` parameter is accepted but never passed through to `CounterfactualMatrix.epoch` or used for telemetry.

### Impact

Confusing API - callers may think epoch is being recorded or used for telemetry, but it's silently ignored.

---

## Recommended Fix

Either:

1. **Remove the parameter** if not needed:
```python
def compute_contributions_from_results(
    self,
    slot_ids: list[str],
    results: dict[tuple[bool, ...], tuple[float, float]],
) -> dict[str, ContributionResult]:
```

2. **Wire it through** to matrix creation if intended for telemetry:
```python
matrix = self.engine.compute_matrix_from_results(
    slot_ids, results, epoch=epoch
)
```

---

## Verification

### How to Verify the Fix

- [ ] Remove or wire through the epoch parameter
- [ ] Update any callers accordingly
- [ ] No functional change if removed

---

## Related Findings

None.

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch5-codereview.md`
**Section:** "P2 - Performance/Correctness Risk" (ID 4)

---

## Cross-Review (Code Review Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `ENDORSE` |
| **Reviewer** | Code Review Specialist |

**Evaluation:** Valid finding per the project's "No Legacy Code Policy" - unused parameters are dead code that should be removed. The recommendation to either delete the parameter or wire it through is appropriate. Given the project's strict stance against keeping unused code, removal is likely the correct action unless there's a clear telemetry use case.

---

## Cross-Review (PyTorch Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `NEUTRAL` |
| **Reviewer** | PyTorch Specialist |
| **Date** | 2024-12-27 |

**Evaluation:** This is a pure API design issue with no PyTorch-specific implications. The unused parameter does not affect tensor operations, memory usage, or training dynamics. The recommendation to either remove or wire through the parameter is reasonable code hygiene. From a PyTorch perspective, if epoch is intended for telemetry, it could be useful for correlating attribution computations with training step for profiling or debugging gradient flow patterns.

---

## Cross-Review (DRL Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `NEUTRAL` |
| **Reviewer** | DRL Specialist |

**Evaluation:** From an RL training perspective, the epoch parameter could be valuable for tracking attribution evolution across training (e.g., do contribution patterns stabilize as policies mature?). However, this is a telemetry concern rather than a training correctness issue. Either wire it through for future analysis or remove it to reduce API surface - both are acceptable. The fix has no impact on training dynamics.
