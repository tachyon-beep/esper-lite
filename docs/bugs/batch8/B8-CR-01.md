# Finding Ticket: Silent NOOP Fallback for Unknown Blueprint Actions

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B8-CR-01` |
| **Severity** | `P1` |
| **Status** | `open` |
| **Batch** | 8 |
| **Agent** | `codereview` |
| **Domain** | `simic/training` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/simic/training/helpers.py` |
| **Line(s)** | `324-327` |
| **Function/Class** | `_convert_flat_to_factored()` |

---

## Summary

**One-line summary:** Unknown blueprint actions silently fallback to NOOP, masking potential bugs.

**Category:**
- [x] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [x] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
# Line 324-327
try:
    blueprint = BlueprintAction[blueprint_name_upper]
except KeyError:
    blueprint = BlueprintAction.NOOP
```

This defensive fallback masks potential bugs:
1. If an action name like `GERMINATE_UNKNOWN` is passed, it silently becomes NOOP
2. If the enum is updated but the conversion logic isn't, unknown actions are silently ignored
3. Per project guidelines, this violates the "no defensive programming to hide bugs" rule

### Impact

- **Silent failures**: Wrong actions executed without any indication
- **Debugging difficulty**: Hard to trace why expected actions didn't happen
- **Policy learning issues**: If heuristic policy selects invalid actions, they become NOOPs, corrupting reward signals

---

## Recommended Fix

Per project guidelines, fail explicitly:

```python
try:
    blueprint = BlueprintAction[blueprint_name_upper]
except KeyError:
    raise ValueError(
        f"Unknown blueprint action: {blueprint_name_upper!r}. "
        f"Valid actions: {[a.name for a in BlueprintAction]}"
    )
```

---

## Verification

### How to Verify the Fix

- [ ] Remove silent fallback, raise ValueError
- [ ] Add test for unknown blueprint action handling
- [ ] Verify heuristic path still works with valid actions

---

## Related Findings

- B8-DRL-07: Same function hardcodes slot_idx=0

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch8-codereview.md`
**Section:** "[P1-2] helpers.py:324-327 - Silent fallback to NOOP"
