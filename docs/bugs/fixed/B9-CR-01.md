# Finding Ticket: "Legacy" Comment Violates No Legacy Code Policy

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B9-CR-01` |
| **Severity** | `P1` |
| **Status** | `closed` |
| **Batch** | 9 |
| **Agent** | `codereview` |
| **Domain** | `tamiyo` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/tamiyo/__init__.py` |
| **Line(s)** | `43-44` |
| **Function/Class** | Module level (`__all__`) |

---

## Summary

**One-line summary:** Comment says "Legacy heuristic (kept for backwards compatibility)" which directly violates CLAUDE.md policy.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [x] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [ ] Defensive programming violation
- [x] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
# Lines 43-44
# Legacy heuristic (kept for backwards compatibility)
"TamiyoPolicy",
```

Per CLAUDE.md: "Legacy code, backwards compatibility, and compatibility shims are strictly forbidden."

The comment suggests these exports are being kept for compatibility rather than because they're actively used. However, `TamiyoPolicy` is the Protocol that `HeuristicTamiyo` implements - it's not legacy, it's the contract.

### Impact

- **Policy violation**: Direct conflict with No Legacy Code Policy
- **Confusion**: Readers may think this is deprecated code
- **Audit risk**: Policy compliance audits will flag this

---

## Recommended Fix

The heuristic is an alternative policy type, not deprecated code. Update the comment:

```python
# Heuristic policy (baseline for comparison)
"TamiyoPolicy",
"HeuristicPolicyConfig",
"HeuristicTamiyo",
```

---

## Verification

### How to Verify the Fix

- [ ] Update comment to not mention "legacy" or "backwards compatibility"
- [ ] Verify TamiyoPolicy is still actively used (grep for imports)
- [ ] Ensure comment accurately describes the purpose

---

## Related Findings

- This finding appears in all 3 specialist reports (CodeReview P1-A, DRL I1, PyTorch P3)

---

## Resolution

### Status: FIXED

**Fixed by updating the misleading comment.**

#### The Fix

Changed line 24 of `src/esper/tamiyo/__init__.py`:

| Before | After |
|--------|-------|
| `# Legacy heuristic (kept for backwards compatibility)` | `# Heuristic policy (baseline for comparison)` |

#### Verification

- ✅ `HeuristicTamiyo` is actively used (5+ references in simic/training)
- ✅ It's described as "baseline comparison" in documentation
- ✅ `TamiyoPolicy` is a Protocol (contract), not deprecated code
- ✅ Comment now accurately reflects purpose

#### Severity Confirmation

- Original: P1 (Policy violation)
- Confirmed: P1 (violated No Legacy Code Policy in CLAUDE.md)
- Resolution: FIXED

---

## Appendix

### Original Report Reference

**Report files:**
- `docs/temp/2712reports/batch9-codereview.md` Section: P1-A
- `docs/temp/2712reports/batch9-drl.md` Section: I1
- `docs/temp/2712reports/batch9-pytorch.md` Section: P3
