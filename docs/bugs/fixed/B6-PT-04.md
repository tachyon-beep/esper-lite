# Finding Ticket: base_acc_delta is Dead Code

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B6-PT-04` |
| **Severity** | `P3` |
| **Status** | `fixed` |
| **Batch** | 6 |
| **Agent** | `pytorch` |
| **Domain** | `simic/rewards` |
| **Assignee** | |
| **Created** | 2024-12-27 |
| **Updated** | 2024-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/simic/rewards/reward_telemetry.py` |
| **Line(s)** | `21` |
| **Function/Class** | `RewardComponentsTelemetry` |

---

## Summary

**One-line summary:** `base_acc_delta` field is never set by any reward function; vestigial from older design.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [x] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [ ] Defensive programming violation
- [x] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
@dataclass(slots=True)
class RewardComponentsTelemetry:
    base_acc_delta: float = 0.0  # Comment says "legacy shaped reward"
```

The `base_acc_delta` field:
1. Has a comment suggesting it's legacy
2. Is never set by any reward function
3. Is always 0.0
4. Appears in `to_dict()` output, polluting telemetry

Per project policy: "When something is removed or changed, DELETE THE OLD CODE COMPLETELY."

---

## Recommended Fix

Remove the field entirely:

```python
@dataclass(slots=True)
class RewardComponentsTelemetry:
    # Remove: base_acc_delta: float = 0.0
```

Also remove from `to_dict()` method.

---

## Verification

### How to Verify the Fix

- [ ] Search codebase for base_acc_delta assignments
- [ ] If none found, remove the field
- [ ] Update to_dict() method
- [ ] Run tests to verify no breakage

---

## Related Findings

- B6-DRL-04: stage_bonus is also dead code
- B6-PT-05: hindsight_credit is also dead code

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch6-pytorch.md`
**Section:** "P3-2: base_acc_delta is Dead Code"

---

## Cross-Review (PyTorch Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `ENDORSE` |
| **Reviewer** | PyTorch Specialist |
| **Date** | 2024-12-27 |

**Evaluation:** Dead fields in telemetry dataclasses add noise to training logs and metrics dashboards, making it harder to diagnose actual training issues. While there is no direct PyTorch impact (this is pure Python), the project's explicit No Legacy Code Policy applies. Removing vestigial fields improves signal-to-noise ratio in telemetry, which is essential for debugging training runs. Straightforward deletion with no risk.

---

## Cross-Review (DRL Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `ENDORSE` |
| **Reviewer** | DRL Specialist |

**Evaluation:** Dead telemetry fields pollute reward diagnostics and create false signal during debugging. When investigating reward component magnitudes or credit assignment issues, engineers may waste time examining `base_acc_delta` before realizing it is vestigial. Per the No Legacy Code Policy, this should be deleted. The field name suggests it was meant to capture accuracy delta as a reward component, which is a reasonable signal; if this was intentionally removed from the reward, the telemetry field should follow.

---

## Cross-Review (Code Review Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `OBJECT` |
| **Reviewer** | Code Review Specialist |

**Evaluation:** The ticket's claim that `base_acc_delta` is "never set" is **incorrect**. Grep shows it IS set in `vectorized.py:2904` and `emitters.py:277`. The field is actively used, not vestigial. The ticket should be closed as invalid, or re-scoped to verify whether those assignment paths are actually reached during normal execution. This requires tracing the call graph before declaring it dead code.

---

## Resolution (2026-01-01)

| Field | Value |
|-------|-------|
| **Resolution** | `WIRED` |
| **Fixed in** | `src/esper/simic/rewards/rewards.py` |

**Analysis:** The Code Review Specialist's objection was based on stale line numbers. Current investigation (2026-01-01) found:
- `vectorized.py:2904` no longer contains `base_acc_delta`
- `emitters.py:277` passes `reward_components` as a typed dataclass but never assigns to `base_acc_delta`

The original ticket was **correct**: `base_acc_delta` in `RewardComponentsTelemetry` was never populated by any reward function.

**Fix Applied:**
Rather than removing the field (as suggested), we wired it properly since `acc_delta` (the per-epoch accuracy change) is a meaningful diagnostic signal for the Sanctum TUI's ΔAcc display:

```python
# In compute_contribution_reward() line 513-514:
# Wire base_acc_delta for Sanctum ΔAcc display (was never populated - bug fix)
components.base_acc_delta = acc_delta if acc_delta is not None else 0.0

# In compute_reward() line 1102-1103 (for SPARSE/MINIMAL/SIMPLIFIED modes):
# Wire base_acc_delta for Sanctum ΔAcc display (was never populated - bug fix)
components.base_acc_delta = acc_delta
```

**Telemetry Flow (now complete):**
1. `acc_delta` → `components.base_acc_delta` (rewards.py) ✅ NEW
2. `components` → `AnalyticsSnapshotPayload.reward_components` (emitters.py) ✅
3. `payload.reward_components.base_acc_delta` → `env.reward_components.base_acc_delta` (aggregator.py:1274) ✅
4. `env.reward_components.base_acc_delta` → Sanctum TUI ΔAcc display (env_overview.py:652) ✅
