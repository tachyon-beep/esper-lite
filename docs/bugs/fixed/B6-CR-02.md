# Finding Ticket: boost_received Parameter Unused in _compute_synergy_bonus

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B6-CR-02` |
| **Severity** | `P1` |
| **Status** | `closed` |
| **Batch** | 6 |
| **Agent** | `codereview` |
| **Domain** | `simic/rewards` |
| **Assignee** | |
| **Created** | 2024-12-27 |
| **Updated** | 2024-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/simic/rewards/rewards.py` |
| **Line(s)** | `1210-1233` |
| **Function/Class** | `_compute_synergy_bonus()` |

---

## Summary

**One-line summary:** The `boost_received` parameter is accepted but never used in the synergy bonus calculation.

**Category:**
- [x] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [x] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
def _compute_synergy_bonus(
    interaction_sum: float,
    boost_received: float,  # <-- NEVER USED
    synergy_weight: float = 0.1,
) -> float:
    """Compute bonus for positive seed interactions.

    Args:
        interaction_sum: Sum of interaction scores with other seeds
        boost_received: Maximum single interaction (UNUSED)
        synergy_weight: Weight for synergy bonus
    """
    if interaction_sum <= 0:
        return 0.0
    raw_bonus = math.tanh(interaction_sum * 0.5)
    return raw_bonus * synergy_weight
```

The `boost_received` parameter:
1. Is documented as "Maximum single interaction"
2. Is passed from the caller (via `SeedInfo.boost_received`)
3. Is never used in the computation

This suggests either:
- Incomplete implementation (boost_received should factor into the bonus)
- Dead code from a removed feature

---

## Recommended Fix

Either incorporate `boost_received` or remove the parameter:

**Option 1 - Use as multiplier:**
```python
def _compute_synergy_bonus(
    interaction_sum: float,
    boost_received: float,
    synergy_weight: float = 0.1,
) -> float:
    if interaction_sum <= 0:
        return 0.0
    raw_bonus = math.tanh(interaction_sum * 0.5)
    # Amplify bonus if received significant boost from a single peer
    boost_factor = 1.0 + 0.5 * math.tanh(boost_received)
    return raw_bonus * synergy_weight * boost_factor
```

**Option 2 - Remove parameter:**
```python
def _compute_synergy_bonus(
    interaction_sum: float,
    synergy_weight: float = 0.1,
) -> float:
    # ... existing logic
```

---

## Verification

### How to Verify the Fix

- [ ] Check `SeedInfo.boost_received` usage in tests to determine original intent
- [ ] Either integrate into bonus or remove parameter
- [ ] Update callers if signature changes

---

## Related Findings

- B6-DRL-03: Synergy bonus not protected by anti-stacking logic

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch6-codereview.md`
**Section:** "P1-2: _compute_synergy_bonus Ignores boost_received Parameter"

---

## Cross-Review (PyTorch Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `NEUTRAL` |
| **Reviewer** | PyTorch Specialist |
| **Date** | 2024-12-27 |

**Evaluation:** Valid dead code finding with no PyTorch-specific implications. Since reward computation is pure Python (no tensor operations), the unused parameter has no memory allocation, gradient tracking, or torch.compile concerns. The issue is purely code hygiene - either the parameter represents incomplete functionality or legacy code that should be removed per project policy. Recommend verifying original design intent before choosing between Option 1 (use it) or Option 2 (remove it).

---

## Cross-Review (DRL Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `ENDORSE` |
| **Reviewer** | DRL Specialist |
| **Date** | 2024-12-27 |

**Evaluation:** Valid finding with RL implications. The `boost_received` (max single interaction) vs `interaction_sum` (total interactions) distinction matters for credit assignment: a seed receiving one strong boost from a single scaffold vs. many weak boosts represents different cooperative dynamics. However, I lean toward Option 2 (remove parameter) unless there is documented design intent. Adding `boost_factor` without empirical justification risks reward hacking via concentration attacks where a single seed-pair colludes to maximize boost. If reintroduced, it should be accompanied by anti-stacking protection per B6-DRL-03.

---

## Cross-Review (Code Review Specialist)

| Field | Value |
|-------|-------|
| **Verdict** | `ENDORSE` |
| **Reviewer** | Code Review Specialist |

**Evaluation:** Verified in source: `boost_received` is passed to `_compute_synergy_bonus` (line 717) but the function body (lines 1228-1233) never references it. Per the No Legacy Code Policy, this is dead code that must be removed - Option 2 (remove parameter) is the correct fix unless there's documented intent to use it. Option 1 (incorporate as multiplier) would require DRL expert review since it changes reward semantics. Recommend removing the parameter and updating the caller at line 716.

---

## Resolution

### Status: FIXED

**Fixed by removing the unused `boost_received` parameter per Option 2.**

#### Evidence Table

| Claim | Status | Evidence |
|-------|--------|----------|
| `boost_received` parameter is passed but never used | ✅ TRUE | Lines 1222-1243: parameter accepted, never referenced |
| Bug exists at claimed location | ✅ TRUE | Function at line 1220 (minor shift from 1210) |
| This is incomplete implementation | ✅ TRUE | Git history shows never used since original commit `f6d267bb` |
| `boost_received` is used elsewhere | ✅ TRUE | Used in hindsight credit ledger (`vectorized.py:2359-2370`), UI, telemetry |

#### Why Option 2 (Remove) Was Chosen

1. **DRL Expert Analysis:** Using `boost_received` in synergy bonus would create "concentration attack" vulnerabilities where seed pairs collude to maximize bonus
2. **Architectural Separation:** `boost_received` feeds hindsight credit (peak interaction tracking); `interaction_sum` feeds synergy bonus (cumulative effort). Using both metrics in the same reward component would double-count.
3. **No Legacy Code Policy:** Dead parameters must be removed, not left as placeholders
4. **Original Intent:** Design docs show `boost_received` was speculatively added; the decision to not use it was correct

#### The Fix

```python
# Before: unused parameter
def _compute_synergy_bonus(
    interaction_sum: float,
    boost_received: float,  # <-- REMOVED
    synergy_weight: float = 0.1,
) -> float:

# After: clean signature
def _compute_synergy_bonus(
    interaction_sum: float,
    synergy_weight: float = 0.1,
) -> float:
```

Added docstring note explaining WHY `boost_received` is intentionally not used (prevents future re-introduction).

#### Severity Assessment

- Original: P1 (correctness bug / dead code)
- Revised: P3 (code hygiene - the omission was intentional design)
- Resolution: FIXED via parameter removal
