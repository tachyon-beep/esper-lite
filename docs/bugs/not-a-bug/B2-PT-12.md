# Finding Ticket: Potential Import Cycle in __init__.py

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B2-PT-12` |
| **Severity** | `P4` |
| **Status** | `open` |
| **Batch** | 2 |
| **Agent** | `pytorch` |
| **Domain** | `kasmina` |
| **Assignee** | |
| **Created** | 2024-12-27 |
| **Updated** | 2024-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/kasmina/__init__.py` |
| **Line(s)** | `14-23` |
| **Function/Class** | Module-level imports |

---

## Summary

**One-line summary:** Re-exports of Leyline lifecycle types could create import cycle if Leyline ever imports from Kasmina.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [x] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

`kasmina/__init__.py` re-exports Leyline types for convenience. If Leyline ever imports from Kasmina, this would create a circular import.

### Code Evidence

```python
# /home/john/esper-lite/src/esper/kasmina/__init__.py:14-23

from esper.leyline import (
    SeedStage,
    AlphaAlgorithm,
    # ... other Leyline types
)
```

### Current Status

**Safe** - Leyline is the "DNA" module and by design should never import from domain modules like Kasmina. The re-export is a convenience for consumers.

---

## Resolution

**No action needed** - the design is correct. Leyline by definition doesn't import from domain modules. Worth noting for future maintainers.

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch2-pytorch.md`
**Section:** "Severity-Tagged Findings Summary" - P4

---

## Cross-Review: DRL Specialist

| Field | Value |
|-------|-------|
| **Reviewer** | DRL Specialist |
| **Date** | 2024-12-27 |
| **Verdict** | **NEUTRAL** (with caveat) |

### Evaluation

The ticket's core assessment is **incomplete**. While `leyline/__init__.py` does not import from Kasmina, `leyline/actions.py:32` contains a deferred import (`from esper.kasmina.blueprints import BlueprintRegistry`) inside `build_action_enum()`. This is safe because:

1. It's a function-level import, executed only when called (not at module import time)
2. Kasmina's `__init__.py` does not import `build_action_enum` from Leyline (it only imports types/constants)

**DRL/Training Implications:** None. The re-exported types (`SeedStage`, `GateLevel`, etc.) are used for seed lifecycle state machines and quality gates, not in hot training paths. The deferred import pattern in `actions.py` is specifically for HeuristicTamiyo baseline (not PPO training), so no performance concern during rollout collection.

**Recommendation:** Ticket should be updated to document the existing deferred import in `leyline/actions.py` as the current mitigation pattern. No code changes needed, but the "Leyline never imports from Kasmina" claim should be clarified to "Leyline never imports from Kasmina at module level."

---

## Cross-Review: Code Review Specialist

| Field | Value |
|-------|-------|
| **Reviewer** | Code Review Specialist |
| **Date** | 2024-12-27 |
| **Verdict** | **ENDORSE** |

### Evaluation

Concur with DRL Specialist's analysis. The deferred import pattern in `/home/john/esper-lite/src/esper/leyline/actions.py:32` is architecturally sound - it breaks the potential cycle by deferring resolution until runtime rather than module load time. The re-export convenience in Kasmina is a legitimate API design choice that improves consumer ergonomics without violating the layered architecture.

**Maintainability note:** The key invariant to preserve is that Leyline's `__init__.py` exports must never transitively trigger Kasmina imports at module load time. This is currently satisfied and verified by `uv run python -c "from esper.kasmina import SeedStage"` succeeding without circular import errors.

---

## Cross-Review: PyTorch Engineering Specialist

| Field | Value |
|-------|-------|
| **Reviewer** | PyTorch Engineering Specialist |
| **Date** | 2024-12-27 |
| **Verdict** | **ENDORSE** |

### Evaluation

Concur with prior reviewers. The deferred import in `leyline/actions.py:32` is safe for `torch.compile` since action enum construction occurs during environment setup, not within compiled forward paths. No graph breaks, module loading latency, or JIT tracing concerns apply here.
