# Finding Ticket: Inconsistent Docstring Depth in factored_lstm.py

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B9-PT-05` |
| **Severity** | `P4` |
| **Status** | `open` |
| **Batch** | 9 |
| **Agent** | `pytorch` |
| **Domain** | `tamiyo/networks` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/tamiyo/networks/factored_lstm.py` |
| **Line(s)** | Various |
| **Function/Class** | Multiple methods |

---

## Summary

**One-line summary:** Some methods have full docstrings with Args/Returns, others have minimal or no docstrings.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [x] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

The file has inconsistent docstring depth:

**Full docstrings** (with Args/Returns sections):
- `get_action()` - comprehensive documentation
- `evaluate_actions()` - comprehensive documentation
- `get_initial_hidden()` - comprehensive with MEMORY MANAGEMENT section

**Minimal docstrings**:
- `_init_weights()` - just one line
- `forward()` - brief description only
- `_build_head()` - no docstring

### Impact

- **Inconsistent API documentation**: Some methods well-documented, others not
- **Onboarding difficulty**: Contributors may not understand less-documented methods
- **IDE experience**: Hover help varies by method

---

## Recommended Fix

Add consistent docstrings to under-documented methods:

```python
def _init_weights(self, module: nn.Module) -> None:
    """Initialize network weights following PPO best practices.

    Initialization strategy:
    - Linear layers: Orthogonal init with gain=sqrt(2) for ReLU
    - Policy heads: Small gain (0.01) for stable initial policies
    - Value head: Standard gain (1.0) for unconstrained estimates
    - LSTM: Forget gate bias = 1.0 (Gers et al., 2000)

    Args:
        module: PyTorch module to initialize
    """

def forward(
    self,
    state: torch.Tensor,
    hidden: HiddenState,
    masks: ActionMasks,
) -> ForwardOutput:
    """Forward pass through actor-critic network.

    Args:
        state: Observation tensor [batch, seq_len, obs_dim]
        hidden: LSTM hidden state tuple (h, c)
        masks: Action masks for each head

    Returns:
        ForwardOutput dict with head_logits, value, hidden
    """
```

---

## Verification

### How to Verify the Fix

- [ ] Add Args/Returns to _init_weights
- [ ] Add Args/Returns to forward
- [ ] Add docstring to _build_head
- [ ] Verify docstring format consistency

---

## Related Findings

- B9-PT-04: Redundant type annotation comments (related documentation)

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch9-codereview.md`
**Section:** "P4-C - Inconsistent docstring style"
