# Finding Ticket: HeadGradientNorms TypedDict Not Exported

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B4-PT-10` |
| **Severity** | `P4` |
| **Status** | `open` |
| **Batch** | 4 |
| **Agent** | `pytorch` |
| **Domain** | `simic` |
| **Assignee** | |
| **Created** | 2024-12-27 |
| **Updated** | 2024-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/simic/agent/types.py` |
| **Line(s)** | `21-36` |
| **Function/Class** | `HeadGradientNorms` |

---

## Summary

**One-line summary:** `HeadGradientNorms` TypedDict is defined but not included in `__init__.py` exports.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [x] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [ ] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

`HeadGradientNorms` is defined in types.py but:
1. Not exported in `agent/__init__.py`
2. Actual code uses `dict[str, list[float]]` instead

```python
# types.py
class HeadGradientNorms(TypedDict):
    op: list[float]
    slot: list[float]
    # ... etc
```

---

## Recommended Fix

Either:

**Option A: Export it**
```python
# In agent/__init__.py
from esper.simic.agent.types import HeadGradientNorms
```

**Option B: Remove it** (if not used)
Per No Legacy Code Policy, if the type is unused, delete it.

---

## Verification

### How to Verify the Fix

- [ ] Check if HeadGradientNorms is used anywhere
- [ ] If used: add to exports
- [ ] If unused: remove definition

---

## Related Findings

- B4-CR-07: head_entropies/head_grad_norms typing (related)
- B4-DRL-10: Missing advantage_mean/std in PPOUpdateMetrics

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch4-pytorch.md`
**Section:** "P4 (Style/Minor)" (TYP-1)

---

## Cross-Review (DRL Specialist)

| Verdict | **ENDORSE** |
|---------|-------------|

**Evaluation:** Per-head gradient norms are critical for diagnosing factored policy learning imbalances. The `dict[str, list[float]]` is used correctly; either export `HeadGradientNorms` for downstream consumers or remove the unused TypedDict per No Legacy Code Policy.

---

## Cross-Review (Code Review Specialist)

| Verdict | **ENDORSE** |
|---------|-------------|

**Evaluation:** Valid finding - `HeadGradientNorms` is in types.py `__all__` but missing from `agent/__init__.py` exports (only 5 of 6 types exported). Either add to package exports for type annotation consumers or remove per No Legacy Code Policy.

---

## Cross-Review (PyTorch Specialist)

| Verdict | **ENDORSE** |
|---------|-------------|

**Evaluation:** Confirmed: `HeadGradientNorms` is defined in types.py but missing from `agent/__init__.py` exports (lines 22-28). Code uses `dict[str, list[float]]` inline. Remove per No Legacy Code Policy - no torch.compile or tensor implications.
