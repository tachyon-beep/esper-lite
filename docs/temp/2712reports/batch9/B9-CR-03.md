# Finding Ticket: Multi-Slot Priority Semantics Undocumented

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B9-CR-03` |
| **Severity** | `P3` |
| **Status** | `open` |
| **Batch** | 9 |
| **Agent** | `codereview` |
| **Domain** | `tamiyo/heuristic` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/tamiyo/heuristic.py` |
| **Line(s)** | `204-286` |
| **Function/Class** | `HeuristicTamiyo._decide_seed_management()` |

---

## Summary

**One-line summary:** Loop returns on first matching seed - multi-slot priority semantics are undocumented.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [x] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
# Lines 204-286
for seed in active_seeds:
    stage = seed.stage
    if stage == SeedStage.TRAINING:
        # ... decision logic
        return decision  # Returns immediately on first match
    elif stage == SeedStage.HOLDING:
        # ... decision logic
        return decision  # Returns immediately on first match
```

The loop iterates over `active_seeds` and returns immediately on the first actionable seed. This works for single-slot scenarios but raises questions for multi-slot:

1. Which seed gets priority? The iteration order is caller-determined
2. Is this first-match behavior intentional?
3. What if multiple seeds need urgent action?

### Impact

- **Unclear semantics**: Readers don't know if iteration order matters
- **Priority inversion risk**: First seed may not be most urgent
- **Multi-slot confusion**: Future multi-slot support may hit issues

---

## Recommended Fix

Document the priority semantics in the method docstring:

```python
def _decide_seed_management(self, signals: TrainingSignals) -> TamiyoDecision | None:
    """Decide lifecycle action for active seeds.

    Priority semantics:
    - Seeds are processed in iteration order (caller-determined)
    - Returns first actionable decision found
    - For multi-slot, caller should sort seeds by urgency before passing

    ...
    """
```

Or consider explicit prioritization:

```python
# Sort by urgency (e.g., longest in current stage, lowest performance)
prioritized = sorted(active_seeds, key=self._seed_urgency_key)
```

---

## Verification

### How to Verify the Fix

- [ ] Add documentation explaining iteration order semantics
- [ ] Consider explicit priority if multi-slot is planned
- [ ] Add test verifying behavior with multiple active seeds

---

## Related Findings

- B9-DRL-04: Summary seed selection (related multi-seed handling)

---

## Appendix

### Original Report Reference

**Report files:**
- `docs/temp/2712reports/batch9-codereview.md` Section: P3-B
- `docs/temp/2712reports/batch9-drl.md` Section: H3
