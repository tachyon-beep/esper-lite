# Finding Ticket: HeuristicPolicyBundle Mimics Protocol But Is Not Registered

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B10-DRL-08` |
| **Severity** | `P3` |
| **Status** | `open` |
| **Batch** | 10 |
| **Agent** | `drl` |
| **Domain** | `tamiyo/policy` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/tamiyo/policy/heuristic_bundle.py` |
| **Line(s)** | Class definition |
| **Function/Class** | `HeuristicPolicyBundle` |

---

## Summary

**One-line summary:** Class mimics `PolicyBundle` interface but intentionally does NOT implement the protocol, which could confuse static analysis and developers.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [x] API design / contract violation
- [ ] Test coverage gap
- [x] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
class HeuristicPolicyBundle:
    """Wraps HeuristicTamiyo to look like a PolicyBundle.

    This is NOT a full PolicyBundle implementation and is NOT registered
    in the policy registry. It exists for:
    - Ablation studies comparing neural vs heuristic
    - Debugging the environment without neural network complexity
    - Providing a baseline for comparison

    Most PolicyBundle methods raise NotImplementedError.
    """
```

Issues:
1. The class has methods like `get_action()`, `evaluate_actions()` that match PolicyBundle
2. But it intentionally raises NotImplementedError for most of them
3. Static type checkers see it as "almost" implementing PolicyBundle
4. Developers might mistakenly try to use it where a PolicyBundle is required

### Impact

- **Low severity**: Documentation/clarity issue
- **Developer confusion**: Class looks like PolicyBundle but isn't
- **Static analysis**: Type checkers may accept it incorrectly

---

## Recommended Fix

Options:

1. **Add explicit type marker** (minimal change):
```python
from typing import TYPE_CHECKING

class HeuristicPolicyBundle:  # Note: Does NOT implement PolicyBundle
    """..."""

    if TYPE_CHECKING:
        # Prevent accidental use as PolicyBundle
        _not_a_policy_bundle: None = None
```

2. **Use a separate base class**:
```python
class HeuristicPolicyAdapter(ABC):
    """Base for heuristic wrappers - NOT a PolicyBundle."""

class HeuristicPolicyBundle(HeuristicPolicyAdapter):
    """..."""
```

3. **Rename to clarify purpose**:
```python
class HeuristicTamiyoAdapter:  # Not "Bundle"
    """Adapter for HeuristicTamiyo - NOT a PolicyBundle."""
```

Option 3 is most explicit - removing "Bundle" from the name makes it clear this isn't a PolicyBundle.

---

## Verification

### How to Verify the Fix

- [ ] Rename class or add explicit non-protocol marker
- [ ] Update imports and usages
- [ ] Verify documentation is clear

---

## Related Findings

None.

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch10-drl.md`
**Section:** HB-1
