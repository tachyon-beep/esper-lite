# Finding Ticket: Deprecated num_slots Parameter Still Has Default

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B10-DRL-04` |
| **Severity** | `P3` |
| **Status** | `open` |
| **Batch** | 10 |
| **Agent** | `drl` |
| **Domain** | `tamiyo/policy` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/tamiyo/policy/factory.py` |
| **Line(s)** | `23, 79-80` |
| **Function/Class** | `create_policy()` |

---

## Summary

**One-line summary:** `num_slots` parameter is marked deprecated but still has a default value, creating confusion for new users.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [x] API design / contract violation
- [ ] Test coverage gap
- [x] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
# Line 23
def create_policy(
    policy_type: str = "lstm",
    num_slots: int = 4,  # Deprecated - use slot_config instead
    slot_config: SlotConfig | None = None,
    ...
)

# Lines 79-80
if slot_config is None:
    slot_config = SlotConfig.for_grid(rows=1, cols=num_slots)
```

The parameter is marked as deprecated in the docstring ("deprecated - use slot_config instead") but still has a functional default. This creates confusion:
1. New users may unknowingly use the deprecated path
2. The parameter continues to be tested and maintained
3. No deprecation warning is emitted

### Impact

- **Low severity**: Code still works correctly
- **Maintenance**: Deprecated code path requires ongoing maintenance
- **API cleanliness**: Confusing for new developers

---

## Recommended Fix

Options:

1. **Remove the parameter entirely** (per No Legacy Code Policy):
```python
def create_policy(
    policy_type: str = "lstm",
    slot_config: SlotConfig,  # Now required
    ...
)
```

2. **Emit deprecation warning** (if gradual migration needed):
```python
if slot_config is None:
    import warnings
    warnings.warn(
        "num_slots is deprecated, use slot_config instead",
        DeprecationWarning,
        stacklevel=2
    )
    slot_config = SlotConfig.for_grid(rows=1, cols=num_slots)
```

Given the No Legacy Code Policy in CLAUDE.md, option 1 is preferred.

---

## Verification

### How to Verify the Fix

- [ ] Remove num_slots parameter
- [ ] Update all call sites to pass slot_config
- [ ] Run tests to verify migration complete

---

## Related Findings

None.

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch10-drl.md`
**Section:** FA-1
