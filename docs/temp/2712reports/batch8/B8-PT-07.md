# Finding Ticket: Misleading _compiled_loss_and_correct Variable Name

---

## Ticket Metadata

| Field | Value |
|-------|-------|
| **Ticket ID** | `B8-PT-07` |
| **Severity** | `P4` |
| **Status** | `open` |
| **Batch** | 8 |
| **Agent** | `pytorch` |
| **Domain** | `simic/training` |
| **Assignee** | |
| **Created** | 2025-12-27 |
| **Updated** | 2025-12-27 |

---

## Location

| Field | Value |
|-------|-------|
| **File(s)** | `/home/john/esper-lite/src/esper/simic/training/vectorized.py` |
| **Line(s)** | `472` |
| **Function/Class** | Module level |

---

## Summary

**One-line summary:** Variable named `_compiled_loss_and_correct` is NOT actually compiled.

**Category:**
- [ ] Correctness bug
- [ ] Race condition / concurrency
- [ ] Memory leak / resource issue
- [ ] Performance bottleneck
- [ ] Numerical stability
- [ ] torch.compile compatibility
- [ ] Dead code / unwired functionality
- [ ] API design / contract violation
- [ ] Test coverage gap
- [x] Documentation / naming
- [ ] Defensive programming violation
- [ ] Legacy code policy violation

---

## Detailed Description

### What's Wrong

```python
# Line 472
# NOTE: torch.compile() of this helper has proven unstable...
_compiled_loss_and_correct = loss_and_correct
```

The variable name suggests it's compiled, but it's actually just an alias to the uncompiled function. This is misleading and could cause confusion about whether compilation is being used.

### Impact

- **Reader confusion**: Name suggests compilation that isn't happening
- **Debugging misdirection**: May waste time investigating compilation issues
- **Documentation mismatch**: Comment and name disagree about function state

---

## Recommended Fix

Rename to reflect actual state:

```python
# Function used for loss and correct count computation.
# Note: torch.compile() proved unstable; using eager execution.
_loss_and_correct_fn = loss_and_correct
```

Or keep the compile attempt and handle gracefully:

```python
try:
    _loss_and_correct_fn = torch.compile(loss_and_correct, mode="reduce-overhead")
except Exception:
    _logger.warning("torch.compile failed for loss_and_correct, using eager")
    _loss_and_correct_fn = loss_and_correct
```

---

## Verification

### How to Verify the Fix

- [ ] Rename variable to not imply compilation
- [ ] Or update to actually compile with fallback
- [ ] Update comment to match behavior

---

## Related Findings

- B8-PT-03: Compiled train step caches fallback permanently

---

## Appendix

### Original Report Reference

**Report file:** `docs/temp/2712reports/batch8-pytorch.md`
**Section:** "P2 - _compiled_loss_and_correct is NOT compiled despite name"
